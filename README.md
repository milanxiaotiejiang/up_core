# up_core

这是 `up_core` 项目的核心库，包含了 GPIO 处理、串口通信等各种功能。

## 环境搭建文档

### 概述

本项目需要搭建一个虚拟环境，并安装必要的依赖项。以下是详细的步骤说明。

### 步骤

1. **创建虚拟环境**

   首先，运行脚本 `./scripts/env.sh` 来创建和配置虚拟环境。

   ```shell
   ./scripts/env.sh
   ```

   该脚本将执行以下操作：

    - 检查虚拟环境是否已存在。如果不存在，则创建一个新的虚拟环境。
    - 激活虚拟环境。
    - 更新 `pip`。
    - 卸载已安装的 `up_core` 库（如果存在）。
    - 安装必要的依赖项，包括 `pybind11`、`wheel` 和 `setuptools`。

2. **安装项目依赖**

   在虚拟环境中，使用 `pip` 安装项目依赖。

   ```shell
   pip install .
   ```

   这将根据 `setup.py` 文件中的配置，安装项目所需的所有依赖项。

### 示例

以下是完整的命令示例：

```shell
# 运行脚本创建和配置虚拟环境
./scripts/env.sh

# 安装项目依赖
pip install .
```

### 注意事项

- 确保已安装 Python 3.8 或更高版本。
- 确保已安装 `pip`。
- 在运行脚本和安装依赖之前，请确保当前目录是项目的根目录。

## up 相关

### 概述

UP 是一个用于构建和管理项目的命令行工具，支持构建 C++ 共享库和 Python 包，并提供清理构建目录的功能。

### 功能特点

- 构建 C++ 共享库 (.so 文件)
- 构建 Python 包 (.whl 文件)
- 清理构建目录和 Python 包目录

### 安装要求

- Python 3.7+
- CMake
- Make

### 基本使用方法

#### 构建 C++ 共享库

```shell
up build so
```

这将生成 C++ 共享库 (.so 文件)。

#### 构建 Python 包

```shell
up build whl
```

这将生成 Python 包 (.whl 文件)。

#### 清理构建目录

```shell
up clean
```

这将清理构建目录和 Python 包目录。

### 完整的命令行选项

```shell
up [命令] [选项]
```

命令说明：

- `build`：构建项目。
    - `so`：构建 C++ 共享库。
    - `whl`：构建 Python 包。
- `clean`：清理构建目录和 Python 包目录。

### 示例

#### 构建 C++ 共享库

```shell
up build so
```

#### 构建 Python 包

```shell
up build whl
```

#### 清理构建目录

```shell
up clean
```

### 注意事项

- 确保已安装 CMake 和 Make 工具。
- 构建前请确保所有依赖项已正确安装。

## uio 相关

### 概述

UIO 是一个用 Python 编写的命令行串口通信工具，提供了简单易用的接口来与各种串口设备进行通信。该工具支持多种串口配置参数，并提供持续收发模式，方便进行串口调试和测试。

### 功能特点

- 查看系统中所有可用的串口设备
- 灵活配置串口参数（波特率、奇偶校验、数据位、停止位等）
- 支持十六进制格式发送和接收数据
- 实时显示接收到的数据
- 持续收发模式便于调试

### 安装要求

- Python 3.6+
- `up_core` 库（用于串口通信）

### 基本使用方法

#### 列出可用串口设备

```shell
uio -l
```

这将显示当前系统中所有可用的串口设备及其详细信息。

#### 连接串口并进入持续收发模式

```shell
uio COM1 -r
```

这将连接到串口设备 `COM1`（在 Windows 上）或 `/dev/ttyUSB0`（在 Linux 上），并进入持续收发模式。

#### 完整的命令行选项

```shell
uio [设备] [选项]
```

参数说明：

- `[设备]`：要连接的串口设备路径（如 `/dev/ttyUSB0`, `COM1`）

选项：

- `-b, --baudrate`：设置波特率（默认: 9600）
- `-p, --parity`：设置奇偶校验模式（默认: none），可选值：none, odd, even, mark, space
- `-d, --databits`：设置数据位长度（默认: 8），可选值：5, 6, 7, 8
- `-s, --stopbits`：设置停止位（默认: 1），可选值：1, 1.5, 2
- `-f, --flowcontrol`：设置流控制模式（默认: none），可选值：none, software, hardware
- `-t, --timeout`：设置超时时间（单位: 秒）
- `-l, --list`：列出当前系统中所有可用的串口设备
- `-r, --raw`：进入持续收发模式
- `-v, --version`：显示版本信息

### 持续收发模式使用说明

在持续收发模式下：

1. 程序会自动启动一个后台线程来监听并显示从串口接收到的所有数据。
2. 用户可以在命令行中输入十六进制数据进行发送。
3. 输入的格式应为十六进制字符串，如 "FF 01 02 03"。
4. 按 `Ctrl+C` 可以退出持续收发模式并关闭串口。

### 示例

#### 以 9600 波特率连接 COM1 并进入持续收发模式

```shell
uio COM1 -b 9600 -r
```

#### 以 115200 波特率、偶校验连接 `/dev/ttyUSB0`

```shell
uio /dev/ttyUSB0 -b 115200 -p even -r
```

#### 自定义所有参数

```shell
uio COM3 -b 38400 -p odd -d 7 -s 1.5 -f hardware -t 2.0 -r
```

### 错误处理

- 如果指定的串口设备不存在或无法访问，程序会显示错误信息并退出。
- 在持续收发模式下，如果输入的十六进制字符串格式不正确，会提示 "无效的十六进制输入" 并要求重新输入。
- 如果串口在通信过程中被关闭或发生错误，程序会捕获异常并给出相应提示。

### 注意事项

- 在 Windows 系统中，串口设备名称通常为 `COM1`、`COM2` 等。
- 在 Linux/Mac 系统中，串口设备名称通常位于 `/dev` 目录下，如 `/dev/ttyUSB0`、`/dev/ttyS0` 等。
- 确保当前用户对指定的串口设备有访问权限。
- 连接设备前，确保波特率等参数与设备要求相匹配。

## pup_core 相关

### 概述

PUP Core 是一个基于 FastAPI 的核心库，提供了串口通信和 WebSocket 通信的功能。该库支持全局异常处理和跨域请求，并包含多个
HTTP 和 WebSocket 路由。

### 功能特点

- 提供串口通信的 HTTP 接口
- 提供 WebSocket 通信接口
- 全局异常处理
- 支持跨域请求

### 安装要求

- Python 3.7+
- FastAPI
- Uvicorn
- `up_core` 库

### 基本使用方法

#### 启动 PUP Core 服务器

```shell
pup_core --host 0.0.0.0 --port 8000 --reload --log-level info
```

这将启动 PUP Core 服务器，监听 `0.0.0.0` 地址的 `8000` 端口，并启用自动重载和信息级别的日志。

#### 完整的命令行选项

```shell
pup_core [选项]
```

选项说明：

- `--host, -h`：设置服务器运行的主机地址（默认: `0.0.0.0`）
- `--port, -p`：设置服务器运行的端口（默认: `8000`）
- `--reload, -r`：启用开发模式下的自动重载
- `--log-level, -l`：设置日志级别（可选值: `debug`, `info`, `warning`, `error`）

### 示例

#### 启动服务器并启用自动重载

```shell
pup_core --host 127.0.0.1 --port 8080 --reload --log-level debug
```

#### 启动服务器并设置日志级别为错误

```shell
pup_core --host 0.0.0.0 --port 8000 --log-level error
```

### 错误处理

- 如果在请求处理过程中发生未捕获的异常，服务器会记录详细的错误日志并返回统一的错误响应。
- 全局异常处理器会捕获所有未处理的异常，并返回 HTTP 500 错误响应。

### 注意事项

- 确保已安装 FastAPI 和 Uvicorn。
- 启动服务器前，请确保所有依赖项已正确安装。
- 在生产环境中运行时，请禁用自动重载功能。