### ServoManager 搜索功能核心思路文档

#### 1. 功能概述

`ServoManager` 提供了一种在指定串口上，通过逐一尝试不同波特率来搜索舵机 ID
的机制。该功能通过异步线程执行，确保搜索过程不会阻塞主程序运行，用户可自定义搜索的波特率和获取搜索结果的回调。

#### 2. 核心设计思路

##### 2.1 异步并发搜索

- **多波特率搜索**：通过用户提供的一组波特率，系统依次尝试每一个波特率来进行舵机通信，寻找相应的舵机设备。为了防止阻塞主线程，搜索过程在一个单独的线程中异步执行。

- **线程安全**：通过使用 `std::atomic` 和互斥锁 (`std::mutex`) 进行线程同步，确保在多线程环境下对共享资源的安全访问，例如搜索状态和结果。

##### 2.2 波特率队列管理

- **波特率队列**：用户提供的波特率列表会被转换成队列（`deque`），搜索线程依次从队列中取出波特率进行尝试。当一个波特率搜索完毕后，该波特率会从队列中移除，直到所有波特率都被处理完。

##### 2.3 搜索流程

- **搜索初始化**：每次搜索开始时，重置搜索状态，包括清空波特率队列、初始化舵机对象映射、以及标记当前正在搜索。

- **舵机通信**：对于每一个波特率，创建一个串口通信对象，并发送 Ping 指令来检测舵机响应。响应成功则意味着该波特率和舵机 ID
  有效，系统会保存该舵机的信息。

- **ID 搜索**：每次搜索一个舵机 ID，从 0 开始递增，直到搜索到最大 ID（通常是 254），再切换到下一个波特率，继续搜索新的舵机。

##### 2.4 回调机制

- **结果回调**：当系统检测到有效的舵机 ID 或发生通信错误时，会通过回调函数将结果返回给用户。回调函数传递的信息包括当前使用的波特率、舵机
  ID，以及可能的错误码。

##### 2.5 停止搜索

- **手动停止**：用户可以随时调用停止函数，停止当前的搜索过程。停止时，系统会通知搜索线程安全退出，并清理相关资源，确保不会留下悬挂线程。

#### 3. 工作流程图

```
[开始搜索] → [初始化状态] → [进入搜索线程] → [取出波特率] → [检测舵机响应] → [处理结果] → [下一个 ID]
          ↑                         ↓
          └───── [停止搜索] ← [所有波特率完成]
```

#### 4. 使用说明

1. **启动搜索**：用户调用 `startSearchServoID` 函数，传入串口号和波特率列表，系统自动开启一个新线程进行搜索。

2. **结果处理**：用户通过设置回调函数来处理每次搜索到的舵机 ID 或错误信息。

3. **停止搜索**：用户可以随时调用 `stopSearchServoID` 停止搜索进程，确保线程安全退出。

#### 5. 适用场景

- 适用于需要在多种波特率下，搜索多个舵机设备 ID 的场景。
- 尤其适合舵机设备数量较多且波特率未知的情况下，通过异步搜索加速舵机设备的发现。

#### 6. 注意事项

- 搜索过程中使用了异步线程，因此需要确保程序结束前正确停止所有搜索线程。
- 波特率的选择应根据实际设备情况，避免尝试无效的波特率，浪费搜索时间。

通过这些核心设计和流程，`ServoManager` 实现了一个高效、可扩展的舵机 ID 搜索机制。